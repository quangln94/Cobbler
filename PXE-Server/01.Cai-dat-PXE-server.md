# PXE Server
## 1. Cài đặt PXE-Server trên CentOS8
### 1.1. Cài đặt TFTP 
```sh
dnf -y install tftp-server
systemctl enable --now tftp.socket
```
### 1.2 Cài đặt và cấu hình DHCP server
**Cài đặt DHCP-Server**
```sh
dnf -y install dhcp-server
```
**Cấu hình DHCP-Server**
```sh
$ vim /etc/dhcp/dhcpd.conf

option domain-name     "srv.world";
option domain-name-servers     dlp.srv.world;
default-lease-time 600;
max-lease-time 7200;
authoritative;

option space pxelinux;
option pxelinux.magic code 208 = string;
option pxelinux.configfile code 209 = text;
option pxelinux.pathprefix code 210 = text;
option pxelinux.reboottime code 211 = unsigned integer 32;
option architecture-type code 93 = unsigned integer 16;

subnet 10.10.20.0 netmask 255.255.255.0 {
    range dynamic-bootp 10.10.20.150 10.10.20.160;
    option broadcast-address 10.10.20.255;
    option routers 10.10.20.1;
    # add follows
    class "pxeclients" {
        match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
        # PXE servers hostname or IP address
        next-server dlp.srv.world;

        if option architecture-type = 00:07 {
            filename "BOOTX64.EFI";
        }
        else {
            filename "pxelinux.0";
        }
    }
}
```
**Enable DHCP-Server**
```sh
systemctl enable --now dhcpd
```
### 1.3. Tải file iso cài đặt cho CentOS8
```sh
wget http://mirrors.viethosting.com/centos/8.2.2004/isos/x86_64/CentOS-8.2.2004-x86_64-minimal.iso
```
### 1.4. Tạo thư mục cho PXE booting
**Cài đặt PXE bootloader**
```sh
sudo dnf install -y syslinux
```
**Copy các file cần thiết sang thư mục `/var/lib/tftpboot/`**
```sh
cp /usr/share/syslinux/{pxelinux.0,menu.c32,vesamenu.c32,ldlinux.c32,libcom32.c32,libutil.c32} /var/lib/tftpboot/
```
**Tạo thư mục lưu file CentOS 8 installer và bootloader**
```sh
mkdir -p /var/pxe/centos8
mkdir /var/lib/tftpboot/centos8
```
**Mount file ISO vào thư mục `/var/pxe/centos8`**
```sh
mount -t iso9660 -o loop,ro CentOS-8.2.2004-x86_64-minimal.iso /var/pxe/centos8
```
**Copy nội dung file ISO vào thư mục `/netboot/www/centos8/`**
```sh
cp /var/pxe/centos8/images/pxeboot/{vmlinuz,initrd.img} /var/lib/tftpboot/centos8/
```
### 1.5. Tạo thư mục cấu hình CentOS 8 PXE booting
```sh
$ mkdir /var/lib/tftpboot/pxelinux.cfg
$ vim /var/lib/tftpboot/pxelinux.cfg/default

default vesamenu.c32
prompt 1
timeout 60

display boot.msg

label linux
  menu label ^Install CentOS 8
  menu default
  kernel centos8/vmlinuz
  append initrd=centos8/initrd.img ip=dhcp inst.repo=http://10.10.20.100/centos8
label vesa
  menu label Install CentOS 8 with ^basic video driver
  kernel centos8/vmlinuz
  append initrd=centos8/initrd.img ip=dhcp inst.xdriver=vesa nomodeset inst.repo=http://10.10.20.100/centos8
label rescue
  menu label ^Rescue installed system
  kernel centos8/vmlinuz
  append initrd=centos8/initrd.img rescue
label local
  menu label Boot from ^local drive
  localboot 0xffff
```
### 1.6. Cấu hình httpd
**Cài đặt httpd**
```sh
dnf -y install httpd
```
**Sửa file cấu hình với nội dung sau:**
```sh
Alias /centos8 /var/pxe/centos8
<Directory /var/pxe/centos8>
    Options Indexes FollowSymLinks
    # access permission
    Require ip 127.0.0.1 10.10.20.0/24
</Directory>
```
### 1.7. Cấu hình Firewalld
```sh
firewall-cmd --add-service={dhcp,http,tftp} --permanent
firewall-cmd --add-port={4011/udp,69/udp} --permanent
firewall-cmd --reload
```

## Tài liệu tham khảo
- https://www.server-world.info/en/note?os=CentOS_8&p=pxe&f=1
- https://linuxhint.com/pxe_network_boot_centos8/
